<!DOCTYPE html>
<html lang="zh-CN">

<!-- Head tag -->
<head>

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!--Description-->

    

    
        <meta name="description" content="原理分析底层抽象：Environment整体 Environment 类关系：
Environment

ConfigurableEnvironment

AbstractEnvironment

StandardEnvironment

  StandardWebEnvironment




C"/>
    

    <!--Author-->
    
        <meta name="author" content="klaus_turbo"/>
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Spring Environment 源码分析"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="原理分析底层抽象：Environment整体 Environment 类关系：
Environment

ConfigurableEnvironment

AbstractEnvironment

StandardEnvironment

  StandardWebEnvironment




C"/>
    

    <!--Open Graph Site Name-->
        <meta property="og:site_name" content="进学致和，行方思远。"/>

    <!--Type page-->
    
        <meta property="og:type" content="article"/>
    

    <!--Page Cover-->
    
    
        <meta property="og:image" content="http://example.comimg/crescent-moon-149988-5530eca8bb0e4a8b92115b454a660af5.jpg"/>
    

        <meta name="twitter:card" content="summary_large_image"/>

    

    
        <meta name="twitter:image" content="http://example.comimg/crescent-moon-149988-5530eca8bb0e4a8b92115b454a660af5.jpg"/>
    

    <!-- Title -->
    
    <title>Spring Environment 源码分析 - 进学致和，行方思远。</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet"/>

    <!-- Google Analytics -->
    


    <!-- favicon -->
    
    <link rel="icon" href="img/sky-earth-space-working-2156-2a5a00a78a854bb7b67af4eb5495480a.jpg"/>
    

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="进学致和，行方思远。" type="application/atom+xml">
</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">进学致和，行方思远。</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                主页
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                归档
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags">
                            
                                标签
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories">
                            
                                分类
                            
                        </a>
                    </li>
                
                    <li>
                        <a target="_blank" rel="noopener" href="https://github.com/klaus-gu">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('/img/crescent-moon-149988-5530eca8bb0e4a8b92115b454a660af5.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Spring Environment 源码分析</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                            Posted by klaus_turbo on
                        
                        
                            2023-03-27
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        


<a href="/tags/Spring/">#Spring</a>


                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                        

<a href="/categories/Spring/">Spring</a>

                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <h2 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h2><h3 id="底层抽象：Environment"><a href="#底层抽象：Environment" class="headerlink" title="底层抽象：Environment"></a>底层抽象：Environment</h3><h3 id="整体-Environment-类关系："><a href="#整体-Environment-类关系：" class="headerlink" title="整体 Environment 类关系："></a>整体 Environment 类关系：</h3><ul>
<li><p>Environment</p>
<ul>
<li><p>ConfigurableEnvironment</p>
<ul>
<li><p>AbstractEnvironment</p>
<ul>
<li><p>StandardEnvironment</p>
<ul>
<li>  StandardWebEnvironment</li>
</ul>
</li>
</ul>
</li>
<li><p>ConfigurableWebEnvironment</p>
<ul>
<li>  StandardServletEnvironment</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="其中最底层的抽象-Environment-定义如下："><a href="#其中最底层的抽象-Environment-定义如下：" class="headerlink" title="其中最底层的抽象 Environment 定义如下："></a>其中最底层的抽象 Environment 定义如下：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Environment</span> <span class="keyword">extends</span> <span class="title">PropertyResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回被激活的配置文件列表.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	String[] getActiveProfiles();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回默认的配置文件列表.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	String[] getDefaultProfiles();</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Deprecated</span></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">acceptsProfiles</span><span class="params">(String... profiles)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用于判断 getActiveProfiles 的返回是否匹配给定的推断表达式.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">acceptsProfiles</span><span class="params">(Profiles profiles)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Profiles 的实现。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Profiles</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Test if this &#123;<span class="doctag">@code</span> Profiles&#125; instance &lt;em&gt;matches&lt;/em&gt; against the given</span></span><br><span class="line"><span class="comment">	 * active profiles predicate.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> activeProfiles predicate that tests whether a given profile is</span></span><br><span class="line"><span class="comment">	 * currently active</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Predicate&lt;String&gt; activeProfiles)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Create a new &#123;<span class="doctag">@link</span> Profiles&#125; instance that checks for matches against</span></span><br><span class="line"><span class="comment">	 * the given &lt;em&gt;profile strings&lt;/em&gt;.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;The returned instance will &#123;<span class="doctag">@linkplain</span> Profiles#matches(Predicate) match&#125;</span></span><br><span class="line"><span class="comment">	 * if any one of the given profile strings matches.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;A profile string may contain a simple profile name (for example</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@code</span> &quot;production&quot;&#125;) or a profile expression. A profile expression allows</span></span><br><span class="line"><span class="comment">	 * for more complicated profile logic to be expressed, for example</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@code</span> &quot;production &amp; cloud&quot;&#125;.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;The following operators are supported in profile expressions:</span></span><br><span class="line"><span class="comment">	 * &lt;ul&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;li&gt;&#123;<span class="doctag">@code</span> !&#125; - A logical &lt;em&gt;not&lt;/em&gt; of the profile&lt;/li&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;li&gt;&#123;<span class="doctag">@code</span> &amp;&#125; - A logical &lt;em&gt;and&lt;/em&gt; of the profiles&lt;/li&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;li&gt;&#123;<span class="doctag">@code</span> |&#125; - A logical &lt;em&gt;or&lt;/em&gt; of the profiles&lt;/li&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Please note that the &#123;<span class="doctag">@code</span> &amp;&#125; and &#123;<span class="doctag">@code</span> |&#125; operators may not be mixed</span></span><br><span class="line"><span class="comment">	 * without using parentheses. For example &#123;<span class="doctag">@code</span> &quot;a &amp; b | c&quot;&#125; is not a valid</span></span><br><span class="line"><span class="comment">	 * expression; it must be expressed as &#123;<span class="doctag">@code</span> &quot;(a &amp; b) | c&quot;&#125; or</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@code</span> &quot;a &amp; (b | c)&quot;&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> profiles the &lt;em&gt;profile strings&lt;/em&gt; to include</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> a new &#123;<span class="doctag">@link</span> Profiles&#125; instance</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> Profiles <span class="title">of</span><span class="params">(String... profiles)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ProfilesParser.parse(profiles);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从上面-Profiles-的定义以及注释文档中可以看出，Spring-提供了更加灵活多变的基于-Profile-的条件配置方式，而这种方式便是通过在-Profiles-中-of（）方法注释可以看出，推断表达式可以使用如下的符号："><a href="#从上面-Profiles-的定义以及注释文档中可以看出，Spring-提供了更加灵活多变的基于-Profile-的条件配置方式，而这种方式便是通过在-Profiles-中-of（）方法注释可以看出，推断表达式可以使用如下的符号：" class="headerlink" title="从上面 Profiles 的定义以及注释文档中可以看出，Spring 提供了更加灵活多变的基于 Profile 的条件配置方式，而这种方式便是通过在 Profiles 中 of（）方法注释可以看出，推断表达式可以使用如下的符号："></a>从上面 Profiles 的定义以及注释文档中可以看出，Spring 提供了更加灵活多变的基于 Profile 的条件配置方式，而这种方式便是通过在 Profiles 中 of（）方法注释可以看出，推断表达式可以使用如下的符号：</h3><ul>
<li>  &amp;</li>
<li>  ｜</li>
<li>  ！</li>
</ul>
<h3 id="需要注意的是-amp-和-｜-两个符号不能混用，即不能出现：a-amp-b-｜c-这样子的表达式配置，应该使用（）括号进行分割："><a href="#需要注意的是-amp-和-｜-两个符号不能混用，即不能出现：a-amp-b-｜c-这样子的表达式配置，应该使用（）括号进行分割：" class="headerlink" title="需要注意的是 &amp; 和 ｜ 两个符号不能混用，即不能出现：a &amp; b ｜c  这样子的表达式配置，应该使用（）括号进行分割："></a>需要注意的是 &amp; 和 ｜ 两个符号不能混用，即不能出现：a &amp; b ｜c  这样子的表达式配置，应该使用（）括号进行分割：</h3><ul>
<li>  a &amp; ( b | c )</li>
<li>  ( a &amp; b ) | c</li>
</ul>
<h3 id="以上是合法的，使用示例："><a href="#以上是合法的，使用示例：" class="headerlink" title="以上是合法的，使用示例："></a>以上是合法的，使用示例：</h3><ul>
<li>  prod &amp; cloud</li>
<li>  prod | cloud</li>
<li>  ( prod &amp; cloud ) | new</li>
<li>  prod &amp; ( cloud | new )&#x20;</li>
</ul>
<h3 id="回到-Environment-之中，可以看到-Environment-其实主要的作用是对于激活配置文件的获取以及一些判断操作，而没有出现我们日常使用过程中使用到的-getProperty-之类的方法，再看一眼-Environment，可以发现其实它是继承了一个叫做-PropertyResolver-的类："><a href="#回到-Environment-之中，可以看到-Environment-其实主要的作用是对于激活配置文件的获取以及一些判断操作，而没有出现我们日常使用过程中使用到的-getProperty-之类的方法，再看一眼-Environment，可以发现其实它是继承了一个叫做-PropertyResolver-的类：" class="headerlink" title="回到 Environment 之中，可以看到 Environment 其实主要的作用是对于激活配置文件的获取以及一些判断操作，而没有出现我们日常使用过程中使用到的 getProperty 之类的方法，再看一眼 Environment，可以发现其实它是继承了一个叫做 PropertyResolver 的类："></a>回到 Environment 之中，可以看到 Environment 其实主要的作用是对于激活配置文件的获取以及一些判断操作，而没有出现我们日常使用过程中使用到的 getProperty 之类的方法，再看一眼 Environment，可以发现其实它是继承了一个叫做 PropertyResolver 的类：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">public interface PropertyResolver &#123;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * 是否包含一个 key</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	boolean containsProperty(String key);</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * 返回一个给定 key 对应的值</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	@Nullable</span><br><span class="line">	String getProperty(String key);</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * 返回给定 key 的值，同时可以预设一个默认值</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	String getProperty(String key, String defaultValue);</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * 返回一个给定 key 对应的值，同时这个值要符合是给定的 targetType 的类型的</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	@Nullable</span><br><span class="line">	&lt;T&gt; T getProperty(String key, Class&lt;T&gt; targetType);</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * 返回一个给定 key 对应的值，同时这个值要符合是给定的 targetType 的类型的，并且可以预设一个默认值</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	&lt;T&gt; T getProperty(String key, Class&lt;T&gt; targetType, T defaultValue);</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * 返回一个给定的 key 对应的值，当不存在的时候抛出异常</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	String getRequiredProperty(String key) throws IllegalStateException;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * 返回一个给定的 key 的值，同时需要符合是 targetType 类型的，若没有抛出异常</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	&lt;T&gt; T getRequiredProperty(String key, Class&lt;T&gt; targetType) throws IllegalStateException;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * 解析 $&#123;...&#125; 表达式，并返回一个 getProperty() 类似的返回</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	String resolvePlaceholders(String text);</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 *  解析 $&#123;...&#125; 表达式，并返回一个 getRequiredProperty() 类似的返回</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	String resolveRequiredPlaceholders(String text) throws IllegalArgumentException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="看到这，有了以下的一些启发："><a href="#看到这，有了以下的一些启发：" class="headerlink" title="看到这，有了以下的一些启发："></a>看到这，有了以下的一些启发：</h3><ol>
<li> Environment 依靠 PropertyResolver 得到了对于配置文件内元素获取的能力</li>
<li> PropertyResolver 是我们处理 spel 表达式的地方</li>
<li> 看到 getProperty 的时候有两个方法是可以传入给定类型的，是不是就是说可以将配置文件中的值获取之后可以做类型转换？</li>
</ol>
<h3 id="看完这个-PropertyResolver-的定义，可以感觉出这个类的作用是很大的，需要引起我们的注意。"><a href="#看完这个-PropertyResolver-的定义，可以感觉出这个类的作用是很大的，需要引起我们的注意。" class="headerlink" title="看完这个 PropertyResolver 的定义，可以感觉出这个类的作用是很大的，需要引起我们的注意。"></a>看完这个 PropertyResolver 的定义，可以感觉出这个类的作用是很大的，需要引起我们的注意。</h3><h3 id="到现在为止，Environment-的定义我们还是比较清楚的，Environment-本身是关注被激活的配置文件的，而它所继承的-PropertyResolver-是关注对于配置文件的操作的。"><a href="#到现在为止，Environment-的定义我们还是比较清楚的，Environment-本身是关注被激活的配置文件的，而它所继承的-PropertyResolver-是关注对于配置文件的操作的。" class="headerlink" title="到现在为止，Environment 的定义我们还是比较清楚的，Environment 本身是关注被激活的配置文件的，而它所继承的 PropertyResolver 是关注对于配置文件的操作的。"></a>到现在为止，Environment 的定义我们还是比较清楚的，Environment 本身是关注被激活的配置文件的，而它所继承的 PropertyResolver 是关注对于配置文件的操作的。</h3><h3 id="顺着开始的类关系往下看，下一个需要看的是-ConfigurableEnvironment，看一下他的定义："><a href="#顺着开始的类关系往下看，下一个需要看的是-ConfigurableEnvironment，看一下他的定义：" class="headerlink" title="顺着开始的类关系往下看，下一个需要看的是 ConfigurableEnvironment，看一下他的定义："></a>顺着开始的类关系往下看，下一个需要看的是 ConfigurableEnvironment，看一下他的定义：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConfigurableEnvironment</span> <span class="keyword">extends</span> <span class="title">Environment</span>, <span class="title">ConfigurablePropertyResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setActiveProfiles</span><span class="params">(String... profiles)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">addActiveProfile</span><span class="params">(String profile)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setDefaultProfiles</span><span class="params">(String... profiles)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">MutablePropertySources <span class="title">getPropertySources</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">Map&lt;String, Object&gt; <span class="title">getSystemProperties</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">Map&lt;String, Object&gt; <span class="title">getSystemEnvironment</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* 用于合并当前容器父类的 Environment 到当前的 Environment</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(ConfigurableEnvironment parent)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="可以看到整体的方法分类分层的方式很-Spring，通常最底层的抽象只能有一些获取或者是判断之类的操作，然后慢慢的一些诸如设置或者更高级别的获取之类的操作就由子类扩展，和-BeanFactory-以及-ConfiguableBeanFactory-之间的关系很像。"><a href="#可以看到整体的方法分类分层的方式很-Spring，通常最底层的抽象只能有一些获取或者是判断之类的操作，然后慢慢的一些诸如设置或者更高级别的获取之类的操作就由子类扩展，和-BeanFactory-以及-ConfiguableBeanFactory-之间的关系很像。" class="headerlink" title="可以看到整体的方法分类分层的方式很 Spring，通常最底层的抽象只能有一些获取或者是判断之类的操作，然后慢慢的一些诸如设置或者更高级别的获取之类的操作就由子类扩展，和 BeanFactory 以及 ConfiguableBeanFactory 之间的关系很像。"></a>可以看到整体的方法分类分层的方式很 Spring，通常最底层的抽象只能有一些获取或者是判断之类的操作，然后慢慢的一些诸如设置或者更高级别的获取之类的操作就由子类扩展，和 BeanFactory 以及 ConfiguableBeanFactory 之间的关系很像。</h3><h3 id="ConfiguableEnvironment-还继承了-ConfigurablePropertyResolver，看一下定义："><a href="#ConfiguableEnvironment-还继承了-ConfigurablePropertyResolver，看一下定义：" class="headerlink" title="ConfiguableEnvironment 还继承了 ConfigurablePropertyResolver，看一下定义："></a>ConfiguableEnvironment 还继承了 ConfigurablePropertyResolver，看一下定义：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConfigurablePropertyResolver</span> <span class="keyword">extends</span> <span class="title">PropertyResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取 ConversionService</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">ConfigurableConversionService <span class="title">getConversionService</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置 ConversionService</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setConversionService</span><span class="params">(ConfigurableConversionService conversionService)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Set the prefix that placeholders replaced by this resolver must begin with.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setPlaceholderPrefix</span><span class="params">(String placeholderPrefix)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Set the suffix that placeholders replaced by this resolver must end with.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setPlaceholderSuffix</span><span class="params">(String placeholderSuffix)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Specify the separating character between the placeholders replaced by this</span></span><br><span class="line"><span class="comment">	 * resolver and their associated default value, or &#123;<span class="doctag">@code</span> null&#125; if no such</span></span><br><span class="line"><span class="comment">	 * special character should be processed as a value separator.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setValueSeparator</span><span class="params">(<span class="meta">@Nullable</span> String valueSeparator)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Set whether to throw an exception when encountering an unresolvable placeholder</span></span><br><span class="line"><span class="comment">	 * nested within the value of a given property. A &#123;<span class="doctag">@code</span> false&#125; value indicates strict</span></span><br><span class="line"><span class="comment">	 * resolution, i.e. that an exception will be thrown. A &#123;<span class="doctag">@code</span> true&#125; value indicates</span></span><br><span class="line"><span class="comment">	 * that unresolvable nested placeholders should be passed through in their unresolved</span></span><br><span class="line"><span class="comment">	 * $&#123;...&#125; form.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Implementations of &#123;<span class="doctag">@link</span> #getProperty(String)&#125; and its variants must inspect</span></span><br><span class="line"><span class="comment">	 * the value set here to determine correct behavior when property values contain</span></span><br><span class="line"><span class="comment">	 * unresolvable placeholders.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@since</span> 3.2</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setIgnoreUnresolvableNestedPlaceholders</span><span class="params">(<span class="keyword">boolean</span> ignoreUnresolvableNestedPlaceholders)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Specify which properties must be present, to be verified by</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> #validateRequiredProperties()&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setRequiredProperties</span><span class="params">(String... requiredProperties)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Validate that each of the properties specified by</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> #setRequiredProperties&#125; is present and resolves to a</span></span><br><span class="line"><span class="comment">	 * non-&#123;<span class="doctag">@code</span> null&#125; value.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> MissingRequiredPropertiesException if any of the required</span></span><br><span class="line"><span class="comment">	 * properties are not resolvable.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">validateRequiredProperties</span><span class="params">()</span> <span class="keyword">throws</span> MissingRequiredPropertiesException</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="这边出现了-ConversionService-这个类，用于解决配置文件中值的类型转换，和我们一开始预想的是一样的，只不过这边又做了一些扩展，将类型转换的工作封装到了一个类中。"><a href="#这边出现了-ConversionService-这个类，用于解决配置文件中值的类型转换，和我们一开始预想的是一样的，只不过这边又做了一些扩展，将类型转换的工作封装到了一个类中。" class="headerlink" title="这边出现了 ConversionService 这个类，用于解决配置文件中值的类型转换，和我们一开始预想的是一样的，只不过这边又做了一些扩展，将类型转换的工作封装到了一个类中。"></a>这边出现了 ConversionService 这个类，用于解决配置文件中值的类型转换，和我们一开始预想的是一样的，只不过这边又做了一些扩展，将类型转换的工作封装到了一个类中。</h3><h3 id="这样一来，整体的-Environment-就变的很明朗了，Environment-自身包括其扩展主要是做对于配置文件进行的操作的，主要是设置激活的配置，设置默认的配置，这两个操作比较重要，因为只有当一个配置（Profile）被激活之后，才会在后续的操作中被容器所管理。而这边-Environment-所继承的-PropertyResolver-以及其实现-ConfigurablePropertyResolver-主要是对于配置内具体的参数的操作，包括设置，获取之类的。"><a href="#这样一来，整体的-Environment-就变的很明朗了，Environment-自身包括其扩展主要是做对于配置文件进行的操作的，主要是设置激活的配置，设置默认的配置，这两个操作比较重要，因为只有当一个配置（Profile）被激活之后，才会在后续的操作中被容器所管理。而这边-Environment-所继承的-PropertyResolver-以及其实现-ConfigurablePropertyResolver-主要是对于配置内具体的参数的操作，包括设置，获取之类的。" class="headerlink" title="这样一来，整体的 Environment 就变的很明朗了，Environment 自身包括其扩展主要是做对于配置文件进行的操作的，主要是设置激活的配置，设置默认的配置，这两个操作比较重要，因为只有当一个配置（Profile）被激活之后，才会在后续的操作中被容器所管理。而这边 Environment 所继承的 PropertyResolver 以及其实现 ConfigurablePropertyResolver 主要是对于配置内具体的参数的操作，包括设置，获取之类的。"></a>这样一来，整体的 Environment 就变的很明朗了，Environment 自身包括其扩展主要是做对于配置文件进行的操作的，主要是设置激活的配置，设置默认的配置，这两个操作比较重要，因为只有当一个配置（Profile）被激活之后，才会在后续的操作中被容器所管理。而这边 Environment 所继承的 PropertyResolver 以及其实现 ConfigurablePropertyResolver 主要是对于配置内具体的参数的操作，包括设置，获取之类的。</h3><h3 id="看完了接口定义之后再看一下他们的实现类，先看一下ConfigurableEnvironment-的抽象实现类：AbstractEnvironment，由于这个类比较长，先看一下他的文档注释："><a href="#看完了接口定义之后再看一下他们的实现类，先看一下ConfigurableEnvironment-的抽象实现类：AbstractEnvironment，由于这个类比较长，先看一下他的文档注释：" class="headerlink" title="看完了接口定义之后再看一下他们的实现类，先看一下ConfigurableEnvironment 的抽象实现类：AbstractEnvironment，由于这个类比较长，先看一下他的文档注释："></a>看完了接口定义之后再看一下他们的实现类，先看一下ConfigurableEnvironment 的抽象实现类：AbstractEnvironment，由于这个类比较长，先看一下他的文档注释：</h3><blockquote>
<p>Abstract base class for Environment implementations. Supports the notion of reserved default profile names and enables specifying active and default profiles through the ACTIVE_PROFILES_PROPERTY_NAME and DEFAULT_PROFILES_PROPERTY_NAME properties.<br>Concrete subclasses differ primarily on which PropertySource objects they add by default. AbstractEnvironment adds none. Subclasses should contribute property sources through the protected customizePropertySources(MutablePropertySources) hook, while clients should customize using ConfigurableEnvironment.getPropertySources() and working against the MutablePropertySources API. See ConfigurableEnvironment javadoc for usage examples.</p>
</blockquote>
<h3 id="这是-AbstractEnvironment-的原注释，大致意思是这个抽象类保留了-Environment-原先的默认的-active-和-default-两种配置文件设置，但是配置方式多增加了一种通过-在配置文件中通过-spring-profiles-active-和-spring-profiles-default-配置的方式，即除了原先的api方式这是这两种配置文件之外，还增加了通过配置文件配置的方式。同时还指出了，实现类的区别只在于实现类内部所引用的-PropertySource-，不同的-PropertySource-则代表了不同的-Environment，同时子类需要通过-AbstractEnviroment-提供的受保护的方法-customizePropertySources-进行-PropertySource-的扩展配置。"><a href="#这是-AbstractEnvironment-的原注释，大致意思是这个抽象类保留了-Environment-原先的默认的-active-和-default-两种配置文件设置，但是配置方式多增加了一种通过-在配置文件中通过-spring-profiles-active-和-spring-profiles-default-配置的方式，即除了原先的api方式这是这两种配置文件之外，还增加了通过配置文件配置的方式。同时还指出了，实现类的区别只在于实现类内部所引用的-PropertySource-，不同的-PropertySource-则代表了不同的-Environment，同时子类需要通过-AbstractEnviroment-提供的受保护的方法-customizePropertySources-进行-PropertySource-的扩展配置。" class="headerlink" title="这是 AbstractEnvironment 的原注释，大致意思是这个抽象类保留了 Environment 原先的默认的 active 和 default 两种配置文件设置，但是配置方式多增加了一种通过 在配置文件中通过 spring.profiles.active 和 spring.profiles.default 配置的方式，即除了原先的api方式这是这两种配置文件之外，还增加了通过配置文件配置的方式。同时还指出了，实现类的区别只在于实现类内部所引用的 PropertySource ，不同的 PropertySource 则代表了不同的 Environment，同时子类需要通过 AbstractEnviroment 提供的受保护的方法 customizePropertySources 进行 PropertySource 的扩展配置。"></a>这是 AbstractEnvironment 的原注释，大致意思是这个抽象类保留了 Environment 原先的默认的 active 和 default 两种配置文件设置，但是配置方式多增加了一种通过 在配置文件中通过 spring.profiles.active 和 spring.profiles.default 配置的方式，即除了原先的api方式这是这两种配置文件之外，还增加了通过配置文件配置的方式。同时还指出了，实现类的区别只在于实现类内部所引用的 PropertySource ，不同的 PropertySource 则代表了不同的 Environment，同时子类需要通过 AbstractEnviroment 提供的受保护的方法 customizePropertySources 进行 PropertySource 的扩展配置。</h3><h3 id="AbstractEnvironment-实现了-ConfigurableEnvironment-，Environment，ConfigurablePropertyResolver，PropertyResolver-这四个接口的所有方法，也就是说通过继承-AbstractEnvironment-这个类就可以获取前面四个接口的所有能力。简单看一下："><a href="#AbstractEnvironment-实现了-ConfigurableEnvironment-，Environment，ConfigurablePropertyResolver，PropertyResolver-这四个接口的所有方法，也就是说通过继承-AbstractEnvironment-这个类就可以获取前面四个接口的所有能力。简单看一下：" class="headerlink" title="AbstractEnvironment 实现了 ConfigurableEnvironment ，Environment，ConfigurablePropertyResolver，PropertyResolver 这四个接口的所有方法，也就是说通过继承 AbstractEnvironment 这个类就可以获取前面四个接口的所有能力。简单看一下："></a>AbstractEnvironment 实现了 ConfigurableEnvironment ，Environment，ConfigurablePropertyResolver，PropertyResolver 这四个接口的所有方法，也就是说通过继承 AbstractEnvironment 这个类就可以获取前面四个接口的所有能力。简单看一下：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsProperty</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.propertyResolver.containsProperty(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getProperty</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.propertyResolver.getProperty(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getProperty</span><span class="params">(String key, String defaultValue)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.propertyResolver.getProperty(key, defaultValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="可以看到实现的内部都是讲具体的操作委托给了-propertyResolver-，回过头去看一下这是什么："><a href="#可以看到实现的内部都是讲具体的操作委托给了-propertyResolver-，回过头去看一下这是什么：" class="headerlink" title="可以看到实现的内部都是讲具体的操作委托给了 propertyResolver ，回过头去看一下这是什么："></a>可以看到实现的内部都是讲具体的操作委托给了 propertyResolver ，回过头去看一下这是什么：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> MutablePropertySources propertySources = <span class="keyword">new</span> MutablePropertySources();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ConfigurablePropertyResolver propertyResolver =</span><br><span class="line">			<span class="keyword">new</span> PropertySourcesPropertyResolver(<span class="keyword">this</span>.propertySources);</span><br></pre></td></tr></table></figure>

<h3 id="可以看到这个-propertyResolver-其实就是-ConfigurablePropertyResolver-的实现类，而且通过传入-MutablePropertySources-使得-propertyResolver-有了可以操作的数据源。"><a href="#可以看到这个-propertyResolver-其实就是-ConfigurablePropertyResolver-的实现类，而且通过传入-MutablePropertySources-使得-propertyResolver-有了可以操作的数据源。" class="headerlink" title="可以看到这个 propertyResolver 其实就是 ConfigurablePropertyResolver 的实现类，而且通过传入 MutablePropertySources 使得 propertyResolver 有了可以操作的数据源。"></a>可以看到这个 propertyResolver 其实就是 ConfigurablePropertyResolver 的实现类，而且通过传入 MutablePropertySources 使得 propertyResolver 有了可以操作的数据源。</h3><h3 id="这边需要注意，不管是什么-Environment-的实现，其最基本的其实就是-MutablePropertySources-这个类，他负责了整个-Environment-内部的配置数据的存储方式。而-proeprtyResolver-也通过在构造的时候接收-MutablePropertySources-实现了-内部操作数据源的初始化。所以上面这两步是整个-Environment-和-PropertyResolver-真正意义上的关联。"><a href="#这边需要注意，不管是什么-Environment-的实现，其最基本的其实就是-MutablePropertySources-这个类，他负责了整个-Environment-内部的配置数据的存储方式。而-proeprtyResolver-也通过在构造的时候接收-MutablePropertySources-实现了-内部操作数据源的初始化。所以上面这两步是整个-Environment-和-PropertyResolver-真正意义上的关联。" class="headerlink" title="这边需要注意，不管是什么 Environment 的实现，其最基本的其实就是 MutablePropertySources 这个类，他负责了整个 Environment 内部的配置数据的存储方式。而 proeprtyResolver 也通过在构造的时候接收 MutablePropertySources 实现了 内部操作数据源的初始化。所以上面这两步是整个 Environment 和 PropertyResolver 真正意义上的关联。"></a>这边需要注意，不管是什么 Environment 的实现，其最基本的其实就是 MutablePropertySources 这个类，他负责了整个 Environment 内部的配置数据的存储方式。而 proeprtyResolver 也通过在构造的时候接收 MutablePropertySources 实现了 内部操作数据源的初始化。所以上面这两步是整个 Environment 和 PropertyResolver 真正意义上的关联。</h3><h3 id="AbstarctEnvironment-除了实现了-Environment-与-PropertyResolver-的关联之外，还定义了-MutablePropertySources-内部的-PropertySource-的查找顺序-的方法："><a href="#AbstarctEnvironment-除了实现了-Environment-与-PropertyResolver-的关联之外，还定义了-MutablePropertySources-内部的-PropertySource-的查找顺序-的方法：" class="headerlink" title="AbstarctEnvironment 除了实现了 Environment 与 PropertyResolver 的关联之外，还定义了 MutablePropertySources  内部的 PropertySource 的查找顺序 的方法："></a>AbstarctEnvironment 除了实现了 Environment 与 PropertyResolver 的关联之外，还定义了 MutablePropertySources  内部的 PropertySource 的查找顺序 的方法：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AbstractEnvironment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		customizePropertySources(<span class="keyword">this</span>.propertySources);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">customizePropertySources</span><span class="params">(MutablePropertySources propertySources)</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通过在实现类中调用父类的-customizePropertySources-方法，并通过一定的逻辑，可以实现按需调整-MutablePropertySources-中-PropertySource-的顺序，看一下官方给出的-demo-："><a href="#通过在实现类中调用父类的-customizePropertySources-方法，并通过一定的逻辑，可以实现按需调整-MutablePropertySources-中-PropertySource-的顺序，看一下官方给出的-demo-：" class="headerlink" title="通过在实现类中调用父类的 customizePropertySources 方法，并通过一定的逻辑，可以实现按需调整 MutablePropertySources 中 PropertySource 的顺序，看一下官方给出的 demo ："></a>通过在实现类中调用父类的 customizePropertySources 方法，并通过一定的逻辑，可以实现按需调整 MutablePropertySources 中 PropertySource 的顺序，看一下官方给出的 demo ：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*Customize the set of PropertySource objects to be searched by this Environment during calls to getProperty(String) and related *methods.</span></span><br><span class="line"><span class="comment">*Subclasses that override this method are encouraged to add property sources using MutablePropertySources.addLast(PropertySource) such *that further subclasses may call super.customizePropertySources() with predictable results. For example:</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Level1Environment</span> <span class="keyword">extends</span> <span class="title">AbstractEnvironment</span> </span>&#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">customizePropertySources</span><span class="params">(MutablePropertySources propertySources)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">super</span>.customizePropertySources(propertySources); <span class="comment">// no-op from base class</span></span><br><span class="line">          propertySources.addLast(<span class="keyword">new</span> PropertySourceA(...));</span><br><span class="line">          propertySources.addLast(<span class="keyword">new</span> PropertySourceB(...));</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Level2Environment</span> <span class="keyword">extends</span> <span class="title">Level1Environment</span> </span>&#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">customizePropertySources</span><span class="params">(MutablePropertySources propertySources)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">super</span>.customizePropertySources(propertySources); <span class="comment">// add all from superclass</span></span><br><span class="line">          propertySources.addLast(<span class="keyword">new</span> PropertySourceC(...));</span><br><span class="line">          propertySources.addLast(<span class="keyword">new</span> PropertySourceD(...));</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*In this arrangement, properties will be resolved against sources A, B, C, D in that order. That is to say that property source &quot;A&quot; *has precedence over property source &quot;D&quot;. If the Level2Environment subclass wished to give property sources C and D higher precedence *than A and B, it could simply call super.customizePropertySources after, rather than before adding its own:</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Level2Environment</span> <span class="keyword">extends</span> <span class="title">Level1Environment</span> </span>&#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">customizePropertySources</span><span class="params">(MutablePropertySources propertySources)</span> </span>&#123;</span><br><span class="line">          propertySources.addLast(<span class="keyword">new</span> PropertySourceC(...));</span><br><span class="line">          propertySources.addLast(<span class="keyword">new</span> PropertySourceD(...));</span><br><span class="line">          <span class="keyword">super</span>.customizePropertySources(propertySources); <span class="comment">// add all from superclass</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment">*The search order is now C, D, A, B as desired.</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="但实际上-MutablePropertySources-内部提供了更为方便的-addFirst，addLast，replace-等方法，所以这个可以忽略吧。"><a href="#但实际上-MutablePropertySources-内部提供了更为方便的-addFirst，addLast，replace-等方法，所以这个可以忽略吧。" class="headerlink" title="但实际上 MutablePropertySources 内部提供了更为方便的 addFirst，addLast，replace 等方法，所以这个可以忽略吧。"></a>但实际上 MutablePropertySources 内部提供了更为方便的 addFirst，addLast，replace 等方法，所以这个可以忽略吧。</h3><h3 id="看完-AbstractEnvironment-，再看一下-MutablePropertySources，这个比较重要的类："><a href="#看完-AbstractEnvironment-，再看一下-MutablePropertySources，这个比较重要的类：" class="headerlink" title="看完 AbstractEnvironment ，再看一下 MutablePropertySources，这个比较重要的类："></a>看完 AbstractEnvironment ，再看一下 MutablePropertySources，这个比较重要的类：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MutablePropertySources</span> <span class="keyword">implements</span> <span class="title">PropertySources</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> List&lt;PropertySource&lt;?&gt;&gt; propertySourceList = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Create a new &#123;<span class="doctag">@link</span> MutablePropertySources&#125; object.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MutablePropertySources</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Create a new &#123;<span class="doctag">@code</span> MutablePropertySources&#125; from the given propertySources</span></span><br><span class="line"><span class="comment">	 * object, preserving the original order of contained &#123;<span class="doctag">@code</span> PropertySource&#125; objects.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MutablePropertySources</span><span class="params">(PropertySources propertySources)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>();</span><br><span class="line">		<span class="keyword">for</span> (PropertySource&lt;?&gt; propertySource : propertySources) &#123;</span><br><span class="line">			addLast(propertySource);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> Iterator&lt;PropertySource&lt;?&gt;&gt; iterator() &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.propertySourceList.iterator();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> Spliterator&lt;PropertySource&lt;?&gt;&gt; spliterator() &#123;</span><br><span class="line">		<span class="keyword">return</span> Spliterators.spliterator(<span class="keyword">this</span>.propertySourceList, <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> Stream&lt;PropertySource&lt;?&gt;&gt; stream() &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.propertySourceList.stream();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.propertySourceList.contains(PropertySource.named(name));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">public</span> PropertySource&lt;?&gt; get(String name) &#123;</span><br><span class="line">		<span class="keyword">int</span> index = <span class="keyword">this</span>.propertySourceList.indexOf(PropertySource.named(name));</span><br><span class="line">		<span class="keyword">return</span> (index != -<span class="number">1</span> ? <span class="keyword">this</span>.propertySourceList.get(index) : <span class="keyword">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Add the given property source object with highest precedence.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(PropertySource&lt;?&gt; propertySource)</span> </span>&#123;</span><br><span class="line">		removeIfPresent(propertySource);</span><br><span class="line">		<span class="keyword">this</span>.propertySourceList.add(<span class="number">0</span>, propertySource);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Add the given property source object with lowest precedence.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLast</span><span class="params">(PropertySource&lt;?&gt; propertySource)</span> </span>&#123;</span><br><span class="line">		removeIfPresent(propertySource);</span><br><span class="line">		<span class="keyword">this</span>.propertySourceList.add(propertySource);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Add the given property source object with precedence immediately higher</span></span><br><span class="line"><span class="comment">	 * than the named relative property source.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBefore</span><span class="params">(String relativePropertySourceName, PropertySource&lt;?&gt; propertySource)</span> </span>&#123;</span><br><span class="line">		assertLegalRelativeAddition(relativePropertySourceName, propertySource);</span><br><span class="line">		removeIfPresent(propertySource);</span><br><span class="line">		<span class="keyword">int</span> index = assertPresentAndGetIndex(relativePropertySourceName);</span><br><span class="line">		addAtIndex(index, propertySource);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Add the given property source object with precedence immediately lower</span></span><br><span class="line"><span class="comment">	 * than the named relative property source.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAfter</span><span class="params">(String relativePropertySourceName, PropertySource&lt;?&gt; propertySource)</span> </span>&#123;</span><br><span class="line">		assertLegalRelativeAddition(relativePropertySourceName, propertySource);</span><br><span class="line">		removeIfPresent(propertySource);</span><br><span class="line">		<span class="keyword">int</span> index = assertPresentAndGetIndex(relativePropertySourceName);</span><br><span class="line">		addAtIndex(index + <span class="number">1</span>, propertySource);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return the precedence of the given property source, &#123;<span class="doctag">@code</span> -1&#125; if not found.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">precedenceOf</span><span class="params">(PropertySource&lt;?&gt; propertySource)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.propertySourceList.indexOf(propertySource);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Remove and return the property source with the given name, &#123;<span class="doctag">@code</span> null&#125; if not found.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name the name of the property source to find and remove</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">public</span> PropertySource&lt;?&gt; remove(String name) &#123;</span><br><span class="line">		<span class="keyword">int</span> index = <span class="keyword">this</span>.propertySourceList.indexOf(PropertySource.named(name));</span><br><span class="line">		<span class="keyword">return</span> (index != -<span class="number">1</span> ? <span class="keyword">this</span>.propertySourceList.remove(index) : <span class="keyword">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Replace the property source with the given name with the given property source object.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name the name of the property source to find and replace</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> propertySource the replacement property source</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IllegalArgumentException if no property source with the given name is present</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> #contains</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">replace</span><span class="params">(String name, PropertySource&lt;?&gt; propertySource)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> index = assertPresentAndGetIndex(name);</span><br><span class="line">		<span class="keyword">this</span>.propertySourceList.set(index, propertySource);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return the number of &#123;<span class="doctag">@link</span> PropertySource&#125; objects contained.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.propertySourceList.size();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.propertySourceList.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Ensure that the given property source is not being added relative to itself.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">assertLegalRelativeAddition</span><span class="params">(String relativePropertySourceName, PropertySource&lt;?&gt; propertySource)</span> </span>&#123;</span><br><span class="line">		String newPropertySourceName = propertySource.getName();</span><br><span class="line">		<span class="keyword">if</span> (relativePropertySourceName.equals(newPropertySourceName)) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">					<span class="string">&quot;PropertySource named &#x27;&quot;</span> + newPropertySourceName + <span class="string">&quot;&#x27; cannot be added relative to itself&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Remove the given property source if it is present.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">removeIfPresent</span><span class="params">(PropertySource&lt;?&gt; propertySource)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.propertySourceList.remove(propertySource);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Add the given property source at a particular index in the list.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addAtIndex</span><span class="params">(<span class="keyword">int</span> index, PropertySource&lt;?&gt; propertySource)</span> </span>&#123;</span><br><span class="line">		removeIfPresent(propertySource);</span><br><span class="line">		<span class="keyword">this</span>.propertySourceList.add(index, propertySource);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Assert that the named property source is present and return its index.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name &#123;<span class="doctag">@linkplain</span> PropertySource#getName() name of the property source&#125; to find</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IllegalArgumentException if the named property source is not present</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">assertPresentAndGetIndex</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> index = <span class="keyword">this</span>.propertySourceList.indexOf(PropertySource.named(name));</span><br><span class="line">		<span class="keyword">if</span> (index == -<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;PropertySource named &#x27;&quot;</span> + name + <span class="string">&quot;&#x27; does not exist&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> index;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="这边直接贴了源码，但是不难发现，其实实际的内部存储结构是一个列表，而其他的一些操作也都是基于列表的操作，而内部的优先级也是按照-PropertySource-在列表中的顺序决定的，PropertySource-的下标索引约小，优先级越高。这个类也没啥好解释的，就是基于列表调整列表内元素的位置。"><a href="#这边直接贴了源码，但是不难发现，其实实际的内部存储结构是一个列表，而其他的一些操作也都是基于列表的操作，而内部的优先级也是按照-PropertySource-在列表中的顺序决定的，PropertySource-的下标索引约小，优先级越高。这个类也没啥好解释的，就是基于列表调整列表内元素的位置。" class="headerlink" title="这边直接贴了源码，但是不难发现，其实实际的内部存储结构是一个列表，而其他的一些操作也都是基于列表的操作，而内部的优先级也是按照 PropertySource 在列表中的顺序决定的，PropertySource 的下标索引约小，优先级越高。这个类也没啥好解释的，就是基于列表调整列表内元素的位置。"></a>这边直接贴了源码，但是不难发现，其实实际的内部存储结构是一个列表，而其他的一些操作也都是基于列表的操作，而内部的优先级也是按照 PropertySource 在列表中的顺序决定的，PropertySource 的下标索引约小，优先级越高。这个类也没啥好解释的，就是基于列表调整列表内元素的位置。</h3><h3 id="再看一下上述列表中的元素：PropertySource"><a href="#再看一下上述列表中的元素：PropertySource" class="headerlink" title="再看一下上述列表中的元素：PropertySource"></a>再看一下上述列表中的元素：PropertySource</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertySource</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">final</span> Log logger = LogFactory.getLog(getClass());</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">final</span> T source;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Create a new &#123;<span class="doctag">@code</span> PropertySource&#125; with the given name and source object.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PropertySource</span><span class="params">(String name, T source)</span> </span>&#123;</span><br><span class="line">		Assert.hasText(name, <span class="string">&quot;Property source name must contain at least one character&quot;</span>);</span><br><span class="line">		Assert.notNull(source, <span class="string">&quot;Property source must not be null&quot;</span>);</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.source = source;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Create a new &#123;<span class="doctag">@code</span> PropertySource&#125; with the given name and with a new</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@code</span> Object&#125; instance as the underlying source.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Often useful in testing scenarios when creating anonymous implementations</span></span><br><span class="line"><span class="comment">	 * that never query an actual source but rather return hard-coded values.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PropertySource</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>(name, (T) <span class="keyword">new</span> Object());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return the name of this &#123;<span class="doctag">@code</span> PropertySource&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return the underlying source object for this &#123;<span class="doctag">@code</span> PropertySource&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> T <span class="title">getSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.source;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return whether this &#123;<span class="doctag">@code</span> PropertySource&#125; contains the given name.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;This implementation simply checks for a &#123;<span class="doctag">@code</span> null&#125; return value</span></span><br><span class="line"><span class="comment">	 * from &#123;<span class="doctag">@link</span> #getProperty(String)&#125;. Subclasses may wish to implement</span></span><br><span class="line"><span class="comment">	 * a more efficient algorithm if possible.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name the property name to find</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsProperty</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (getProperty(name) != <span class="keyword">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return the value associated with the given name,</span></span><br><span class="line"><span class="comment">	 * or &#123;<span class="doctag">@code</span> null&#125; if not found.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name the property to find</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> PropertyResolver#getRequiredProperty(String)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Object <span class="title">getProperty</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * This &#123;<span class="doctag">@code</span> PropertySource&#125; object is equal to the given object if:</span></span><br><span class="line"><span class="comment">	 * &lt;ul&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;li&gt;they are the same instance</span></span><br><span class="line"><span class="comment">	 * &lt;li&gt;the &#123;<span class="doctag">@code</span> name&#125; properties for both objects are equal</span></span><br><span class="line"><span class="comment">	 * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;No properties other than &#123;<span class="doctag">@code</span> name&#125; are evaluated.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object other)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">this</span> == other || (other <span class="keyword">instanceof</span> PropertySource &amp;&amp;</span><br><span class="line">				ObjectUtils.nullSafeEquals(<span class="keyword">this</span>.name, ((PropertySource&lt;?&gt;) other).name)));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return a hash code derived from the &#123;<span class="doctag">@code</span> name&#125; property</span></span><br><span class="line"><span class="comment">	 * of this &#123;<span class="doctag">@code</span> PropertySource&#125; object.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ObjectUtils.nullSafeHashCode(<span class="keyword">this</span>.name);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Produce concise output (type and name) if the current log level does not include</span></span><br><span class="line"><span class="comment">	 * debug. If debug is enabled, produce verbose output including the hash code of the</span></span><br><span class="line"><span class="comment">	 * PropertySource instance and every name/value property pair.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;This variable verbosity is useful as a property source such as system properties</span></span><br><span class="line"><span class="comment">	 * or environment variables may contain an arbitrary number of property pairs,</span></span><br><span class="line"><span class="comment">	 * potentially leading to difficult to read exception and log messages.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> Log#isDebugEnabled()</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">			<span class="keyword">return</span> getClass().getSimpleName() + <span class="string">&quot;@&quot;</span> + System.identityHashCode(<span class="keyword">this</span>) +</span><br><span class="line">					<span class="string">&quot; &#123;name=&#x27;&quot;</span> + <span class="keyword">this</span>.name + <span class="string">&quot;&#x27;, properties=&quot;</span> + <span class="keyword">this</span>.source + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> getClass().getSimpleName() + <span class="string">&quot; &#123;name=&#x27;&quot;</span> + <span class="keyword">this</span>.name + <span class="string">&quot;&#x27;&#125;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return a &#123;<span class="doctag">@code</span> PropertySource&#125; implementation intended for collection comparison purposes only.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Primarily for internal use, but given a collection of &#123;<span class="doctag">@code</span> PropertySource&#125; objects, may be</span></span><br><span class="line"><span class="comment">	 * used as follows:</span></span><br><span class="line"><span class="comment">	 * &lt;pre class=&quot;code&quot;&gt;</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@code</span> List&lt;PropertySource&lt;?&gt;&gt; sources = new ArrayList&lt;PropertySource&lt;?&gt;&gt;();</span></span><br><span class="line"><span class="comment">	 * sources.add(new MapPropertySource(&quot;sourceA&quot;, mapA));</span></span><br><span class="line"><span class="comment">	 * sources.add(new MapPropertySource(&quot;sourceB&quot;, mapB));</span></span><br><span class="line"><span class="comment">	 * assert sources.contains(PropertySource.named(&quot;sourceA&quot;));</span></span><br><span class="line"><span class="comment">	 * assert sources.contains(PropertySource.named(&quot;sourceB&quot;));</span></span><br><span class="line"><span class="comment">	 * assert !sources.contains(PropertySource.named(&quot;sourceC&quot;));</span></span><br><span class="line"><span class="comment">	 * &#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="comment">	 * The returned &#123;<span class="doctag">@code</span> PropertySource&#125; will throw &#123;<span class="doctag">@code</span> UnsupportedOperationException&#125;</span></span><br><span class="line"><span class="comment">	 * if any methods other than &#123;<span class="doctag">@code</span> equals(Object)&#125;, &#123;<span class="doctag">@code</span> hashCode()&#125;, and &#123;<span class="doctag">@code</span> toString()&#125;</span></span><br><span class="line"><span class="comment">	 * are called.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name the name of the comparison &#123;<span class="doctag">@code</span> PropertySource&#125; to be created and returned.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> PropertySource&lt;?&gt; named(String name) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ComparisonPropertySource(name);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="这个类的定义很简单，一个-name-名字表示这个PropertySource，还有一个泛型-T-表示实际内部存储的数据结构，虽然是泛型，但是由于在-getProperty-的时候会传入一个-key-所以这个泛型实际上其实还是一个-k-v-的形式的数据结构。"><a href="#这个类的定义很简单，一个-name-名字表示这个PropertySource，还有一个泛型-T-表示实际内部存储的数据结构，虽然是泛型，但是由于在-getProperty-的时候会传入一个-key-所以这个泛型实际上其实还是一个-k-v-的形式的数据结构。" class="headerlink" title="这个类的定义很简单，一个 name 名字表示这个PropertySource，还有一个泛型 T 表示实际内部存储的数据结构，虽然是泛型，但是由于在 getProperty 的时候会传入一个 key 所以这个泛型实际上其实还是一个 k-v 的形式的数据结构。"></a>这个类的定义很简单，一个 name 名字表示这个PropertySource，还有一个泛型 T 表示实际内部存储的数据结构，虽然是泛型，但是由于在 getProperty 的时候会传入一个 key 所以这个泛型实际上其实还是一个 k-v 的形式的数据结构。</h3><h3 id="name-的作用就是为了区别，隔离各个-PropertySource。其中定义的-getProperty-也是留给子类自己去实现如何操作获取结果，比如我现在要实现一个最简单的-PropertySource，那就是这个泛型-T-就直接是-HashMap-就好了，getProperty-直接就是-Map-get。"><a href="#name-的作用就是为了区别，隔离各个-PropertySource。其中定义的-getProperty-也是留给子类自己去实现如何操作获取结果，比如我现在要实现一个最简单的-PropertySource，那就是这个泛型-T-就直接是-HashMap-就好了，getProperty-直接就是-Map-get。" class="headerlink" title="name 的作用就是为了区别，隔离各个 PropertySource。其中定义的 getProperty 也是留给子类自己去实现如何操作获取结果，比如我现在要实现一个最简单的 PropertySource，那就是这个泛型 T 就直接是 HashMap 就好了，getProperty 直接就是 Map.get。"></a>name 的作用就是为了区别，隔离各个 PropertySource。其中定义的 getProperty 也是留给子类自己去实现如何操作获取结果，比如我现在要实现一个最简单的 PropertySource，那就是这个泛型 T 就直接是 HashMap 就好了，getProperty 直接就是 Map.get。</h3><h3 id="看完分析完-MutablePropertySources-以及内部数据结构定义之后看一下-PropertyResolver的实现："><a href="#看完分析完-MutablePropertySources-以及内部数据结构定义之后看一下-PropertyResolver的实现：" class="headerlink" title="看完分析完 MutablePropertySources 以及内部数据结构定义之后看一下 PropertyResolver的实现："></a>看完分析完 MutablePropertySources 以及内部数据结构定义之后看一下 PropertyResolver的实现：</h3><ul>
<li><p>ConfigurablePropertyResolver</p>
<ul>
<li><p>AbstractPropertyResolver</p>
<ul>
<li>  PropertySourcesPropertyResolver</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="这是-Spring-的默认的-PropertyResolver-的实现流程，前面已经分析了-ConfigurablePropertyResolver-，再看看-AbstractPropertyResolver："><a href="#这是-Spring-的默认的-PropertyResolver-的实现流程，前面已经分析了-ConfigurablePropertyResolver-，再看看-AbstractPropertyResolver：" class="headerlink" title="这是 Spring 的默认的 PropertyResolver 的实现流程，前面已经分析了 ConfigurablePropertyResolver ，再看看 AbstractPropertyResolver："></a>这是 Spring 的默认的 PropertyResolver 的实现流程，前面已经分析了 ConfigurablePropertyResolver ，再看看 AbstractPropertyResolver：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractPropertyResolver</span> <span class="keyword">implements</span> <span class="title">ConfigurablePropertyResolver</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">volatile</span> ConfigurableConversionService conversionService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ConfigurableConversionService <span class="title">getConversionService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// Need to provide an independent DefaultConversionService, not the</span></span><br><span class="line">		<span class="comment">// shared DefaultConversionService used by PropertySourcesPropertyResolver.</span></span><br><span class="line">		ConfigurableConversionService cs = <span class="keyword">this</span>.conversionService;</span><br><span class="line">		<span class="keyword">if</span> (cs == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">				cs = <span class="keyword">this</span>.conversionService;</span><br><span class="line">				<span class="keyword">if</span> (cs == <span class="keyword">null</span>) &#123;</span><br><span class="line">					cs = <span class="keyword">new</span> DefaultConversionService();</span><br><span class="line">					<span class="keyword">this</span>.conversionService = cs;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> cs;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConversionService</span><span class="params">(ConfigurableConversionService conversionService)</span> </span>&#123;</span><br><span class="line">		Assert.notNull(conversionService, <span class="string">&quot;ConversionService must not be null&quot;</span>);</span><br><span class="line">		<span class="keyword">this</span>.conversionService = conversionService;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">protected</span> &lt;T&gt; <span class="function">T <span class="title">convertValueIfNecessary</span><span class="params">(Object value, <span class="meta">@Nullable</span> Class&lt;T&gt; targetType)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (targetType == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> (T) value;</span><br><span class="line">		&#125;</span><br><span class="line">		ConversionService conversionServiceToUse = <span class="keyword">this</span>.conversionService;</span><br><span class="line">		<span class="keyword">if</span> (conversionServiceToUse == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">// Avoid initialization of shared DefaultConversionService if</span></span><br><span class="line">			<span class="comment">// no standard type conversion is needed in the first place...</span></span><br><span class="line">			<span class="keyword">if</span> (ClassUtils.isAssignableValue(targetType, value)) &#123;</span><br><span class="line">				<span class="keyword">return</span> (T) value;</span><br><span class="line">			&#125;</span><br><span class="line">			conversionServiceToUse = DefaultConversionService.getSharedInstance();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> conversionServiceToUse.convert(value, targetType);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="篇幅比较长，截取其中比较重要的部分。这部分的代码可以看到涉及到了前面提到过的-ConversionService，这个类主要负责类型的转换，也就是因为这部分的实现，使得-ConfigurablePropertyResolver-后续的实现类有了类型转换的能力。其中还定义了一个-convertValueIfNessary-用于实际的类型转换工作。AbstractPropertyResolver-也实现了-getProperty-："><a href="#篇幅比较长，截取其中比较重要的部分。这部分的代码可以看到涉及到了前面提到过的-ConversionService，这个类主要负责类型的转换，也就是因为这部分的实现，使得-ConfigurablePropertyResolver-后续的实现类有了类型转换的能力。其中还定义了一个-convertValueIfNessary-用于实际的类型转换工作。AbstractPropertyResolver-也实现了-getProperty-：" class="headerlink" title="篇幅比较长，截取其中比较重要的部分。这部分的代码可以看到涉及到了前面提到过的 ConversionService，这个类主要负责类型的转换，也就是因为这部分的实现，使得 ConfigurablePropertyResolver 后续的实现类有了类型转换的能力。其中还定义了一个 convertValueIfNessary 用于实际的类型转换工作。AbstractPropertyResolver 也实现了 getProperty ："></a>篇幅比较长，截取其中比较重要的部分。这部分的代码可以看到涉及到了前面提到过的 ConversionService，这个类主要负责类型的转换，也就是因为这部分的实现，使得 ConfigurablePropertyResolver 后续的实现类有了类型转换的能力。其中还定义了一个 convertValueIfNessary 用于实际的类型转换工作。AbstractPropertyResolver 也实现了 getProperty ：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsProperty</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (getProperty(key) != <span class="keyword">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getProperty</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> getProperty(key, String.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getProperty</span><span class="params">(String key, String defaultValue)</span> </span>&#123;</span><br><span class="line">		String value = getProperty(key);</span><br><span class="line">		<span class="keyword">return</span> (value != <span class="keyword">null</span> ? value : defaultValue);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getProperty</span><span class="params">(String key, Class&lt;T&gt; targetType, T defaultValue)</span> </span>&#123;</span><br><span class="line">		T value = getProperty(key, targetType);</span><br><span class="line">		<span class="keyword">return</span> (value != <span class="keyword">null</span> ? value : defaultValue);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="可以看到这之间的所有操作其实最后都会关联到-getProperty（String-key，Class-targetClass），但是这个方法的具体实现并没有在-AbstractPropertyResolver-这边实现，而是放到了子类去实现，而且这边也看到了，并没有相关的-PropertySources-数据源可以实际的去操作。所以看最终的实现类：PropertySourcesPropertyResolver："><a href="#可以看到这之间的所有操作其实最后都会关联到-getProperty（String-key，Class-targetClass），但是这个方法的具体实现并没有在-AbstractPropertyResolver-这边实现，而是放到了子类去实现，而且这边也看到了，并没有相关的-PropertySources-数据源可以实际的去操作。所以看最终的实现类：PropertySourcesPropertyResolver：" class="headerlink" title="可以看到这之间的所有操作其实最后都会关联到 getProperty（String key，Class targetClass），但是这个方法的具体实现并没有在 AbstractPropertyResolver 这边实现，而是放到了子类去实现，而且这边也看到了，并没有相关的 PropertySources 数据源可以实际的去操作。所以看最终的实现类：PropertySourcesPropertyResolver："></a>可以看到这之间的所有操作其实最后都会关联到 getProperty（String key，Class targetClass），但是这个方法的具体实现并没有在 AbstractPropertyResolver 这边实现，而是放到了子类去实现，而且这边也看到了，并没有相关的 PropertySources 数据源可以实际的去操作。所以看最终的实现类：PropertySourcesPropertyResolver：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertySourcesPropertyResolver</span> <span class="keyword">extends</span> <span class="title">AbstractPropertyResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> PropertySources propertySources;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Create a new resolver against the given property sources.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> propertySources the set of &#123;<span class="doctag">@link</span> PropertySource&#125; objects to use</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PropertySourcesPropertyResolver</span><span class="params">(<span class="meta">@Nullable</span> PropertySources propertySources)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.propertySources = propertySources;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsProperty</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.propertySources != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (PropertySource&lt;?&gt; propertySource : <span class="keyword">this</span>.propertySources) &#123;</span><br><span class="line">				<span class="keyword">if</span> (propertySource.containsProperty(key)) &#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getProperty</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> getProperty(key, String.class, <span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getProperty</span><span class="params">(String key, Class&lt;T&gt; targetValueType)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> getProperty(key, targetValueType, <span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> String <span class="title">getPropertyAsRawString</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> getProperty(key, String.class, <span class="keyword">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">protected</span> &lt;T&gt; <span class="function">T <span class="title">getProperty</span><span class="params">(String key, Class&lt;T&gt; targetValueType, <span class="keyword">boolean</span> resolveNestedPlaceholders)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.propertySources != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (PropertySource&lt;?&gt; propertySource : <span class="keyword">this</span>.propertySources) &#123;</span><br><span class="line">				<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">					logger.trace(<span class="string">&quot;Searching for key &#x27;&quot;</span> + key + <span class="string">&quot;&#x27; in PropertySource &#x27;&quot;</span> +</span><br><span class="line">							propertySource.getName() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				Object value = propertySource.getProperty(key);</span><br><span class="line">				<span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</span><br><span class="line">					<span class="keyword">if</span> (resolveNestedPlaceholders &amp;&amp; value <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">						value = resolveNestedPlaceholders((String) value);</span><br><span class="line">					&#125;</span><br><span class="line">					logKeyFound(key, propertySource, value);</span><br><span class="line">					<span class="keyword">return</span> convertValueIfNecessary(value, targetValueType);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">			logger.trace(<span class="string">&quot;Could not find key &#x27;&quot;</span> + key + <span class="string">&quot;&#x27; in any property source&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">logKeyFound</span><span class="params">(String key, PropertySource&lt;?&gt; propertySource, Object value)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">			logger.debug(<span class="string">&quot;Found key &#x27;&quot;</span> + key + <span class="string">&quot;&#x27; in PropertySource &#x27;&quot;</span> + propertySource.getName() +</span><br><span class="line">					<span class="string">&quot;&#x27; with value of type &quot;</span> + value.getClass().getSimpleName());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="这边核心就是-getProperty-String-key-Class-lt-T-gt-targetValueType-boolean-resolveNestedPlaceholders-方法，实现了从-PropertySources-中去查找需要的值。而其中的操作也是比较简单的，通过遍历-PropertySources-从头开始查找，只要找到就直接返回。结合前面提到的优先级，也就在这边体现出来了，因为遍历一般就是从第一个元素开始的，所以前面在-MutablePropertySources-部分的-addLast，addFirst，也可以看出其操作的意义了。"><a href="#这边核心就是-getProperty-String-key-Class-lt-T-gt-targetValueType-boolean-resolveNestedPlaceholders-方法，实现了从-PropertySources-中去查找需要的值。而其中的操作也是比较简单的，通过遍历-PropertySources-从头开始查找，只要找到就直接返回。结合前面提到的优先级，也就在这边体现出来了，因为遍历一般就是从第一个元素开始的，所以前面在-MutablePropertySources-部分的-addLast，addFirst，也可以看出其操作的意义了。" class="headerlink" title="这边核心就是 getProperty(String key, Class&lt;T&gt; targetValueType, boolean resolveNestedPlaceholders) 方法，实现了从 PropertySources 中去查找需要的值。而其中的操作也是比较简单的，通过遍历 PropertySources 从头开始查找，只要找到就直接返回。结合前面提到的优先级，也就在这边体现出来了，因为遍历一般就是从第一个元素开始的，所以前面在 MutablePropertySources 部分的 addLast，addFirst，也可以看出其操作的意义了。"></a>这边核心就是 getProperty(String key, Class&lt;T&gt; targetValueType, boolean resolveNestedPlaceholders) 方法，实现了从 PropertySources 中去查找需要的值。而其中的操作也是比较简单的，通过遍历 PropertySources 从头开始查找，只要找到就直接返回。结合前面提到的优先级，也就在这边体现出来了，因为遍历一般就是从第一个元素开始的，所以前面在 MutablePropertySources 部分的 addLast，addFirst，也可以看出其操作的意义了。</h3><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><p> Environment 主要的作用是为获取配置文件，编辑配置文件内容提供一种方便。本身没有意义。</p>
</li>
<li><p> Environment 及其实现类主要关注的是 激活的配置文件（active / default 两种）不关心配置文件的内容。</p>
</li>
<li><p> PropertyResolver 及其实现类关心的是对于配置内容的操作以及获取，所以它是关心配置文件内容的。</p>
</li>
<li><p>MutablePropertySources 是实际也是最终起到配置文件，配置信息存储的地方，所有的操作都是围绕 MutablePropertySources 实现的。</p>
<ol>
<li> 其内部是一个有序的列表，优先级体现在配置插入列表的索引位置，越靠前优先级越高，addfirst</li>
<li> 越靠后优先级越低，addLast</li>
<li> 内部列表中是各种 PropertySource 的实现</li>
<li> 各个 PropertySource 通过 name 字段相互隔离</li>
</ol>
</li>
<li><p> PropertyResolver 在操作 MutablePropertySources 的时候，只要查找到一个就会返回，配置文件的覆盖的意义就体现在这里。</p>
</li>
</ol>
<p>本人关于图片作品版权的声明：</p>
<ol>
<li><p>本人在此刊载的原创作品，其版权归属本人所有。</p>
</li>
<li><p>任何传统媒体、商业公司或其他网站未经本人的授权许可，不得擅自从本人转载、转贴或者以任何其他方式复制、使用上述作品。</p>
</li>
<li><p>传统媒体、商业公司或其他网站对上述作品的任何使用，均须事先与本人联系。</p>
</li>
<li><p>对于侵犯本人的合法权益的公司、媒体、网站和人员，本人聘请的律师受本人的委托，将采取必要的措施，通过包括法律诉讼在内的途径来维护本人的合法权益。</p>
</li>
</ol>
<p>特此声明，敬请合作。</p>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    
                        <li>
                            <a href="https://github.com/klaus-gu" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                        <li>
                            <a href="mailto:guyue375@outlook.com" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2023 klaus_turbo<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>